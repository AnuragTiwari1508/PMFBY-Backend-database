# PMFBY Backend Setup à¤”à¤° Installation Guide\n\n## ğŸš€ Complete Backend Setup for PMFBY Flutter App\n\n### ğŸ“‹ Project Overview\nà¤¯à¤¹ à¤à¤• complete backend system à¤¹à¥ˆ à¤œà¥‹ Flutter PMFBY app à¤•à¥‡ à¤²à¤¿à¤ à¤¬à¤¨à¤¾à¤¯à¤¾ à¤—à¤¯à¤¾ à¤¹à¥ˆà¥¤ à¤‡à¤¸à¤®à¥‡à¤‚ à¤¶à¤¾à¤®à¤¿à¤² à¤¹à¥ˆà¤‚:\n- User Authentication (JWT based)\n- MongoDB Atlas integration\n- Photo Upload & Storage (GridFS)\n- ML/AI integration for crop analysis\n- Comprehensive logging à¤”à¤° analytics\n- Real-time data processing\n\n### ğŸ› ï¸ Technology Stack\n- **Backend**: Node.js + Express.js\n- **Database**: MongoDB Atlas\n- **AI/ML**: Python + TensorFlow\n- **File Storage**: GridFS\n- **Authentication**: JWT + bcrypt\n- **Frontend**: Flutter (Dart)\n\n## ğŸ“¦ Installation Steps\n\n### 1. Backend Server Setup\n\n```bash\n# Navigate to backend directory\ncd backend/\n\n# Install dependencies\nnpm install\n\n# Create logs directory\nmkdir logs\n\n# Start the server\nnpm run dev\n```\n\n### 2. Python ML Server Setup\n\n```bash\n# Navigate to ML server directory\ncd backend/ml_server/\n\n# Create virtual environment\npython -m venv venv\n\n# Activate virtual environment\n# On Windows:\nvenv\\Scripts\\activate\n# On macOS/Linux:\nsource venv/bin/activate\n\n# Install dependencies\npip install -r requirements.txt\n\n# Create models directory\nmkdir models\n\n# Start ML server\npython app.py\n```\n\n### 3. Flutter App Setup\n\n```bash\n# In project root directory\nflutter pub get\n\n# Generate code for models and API service\nflutter packages pub run build_runner build\n\n# Run the app\nflutter run\n```\n\n## ğŸ”§ Environment Configuration\n\n### Backend Environment Variables (.env)\n```env\n# MongoDB Configuration\nMONGODB_URI=mongodb+srv://chitransh-sahu:z6ecOZiKWNxVqiJP@cluster0.ufrhke7.mongodb.net/pmfby_database?retryWrites=true&w=majority&appName=Cluster0\nDB_NAME=pmfby_database\n\n# JWT Configuration\nJWT_SECRET=pmfby_super_secure_jwt_secret_key_2024\nJWT_EXPIRE_TIME=7d\nREFRESH_TOKEN_SECRET=pmfby_refresh_token_secret_key_2024\nREFRESH_TOKEN_EXPIRE_TIME=30d\n\n# Server Configuration\nPORT=3000\nNODE_ENV=development\nAPI_BASE_URL=http://localhost:3000/api\n\n# ML Server Configuration\nPYTHON_ML_SERVER_URL=http://localhost:5000\nML_PORT=5000\n\n# Security Configuration\nBCRYPT_ROUNDS=12\nRATE_LIMIT_WINDOW=900000\nRATE_LIMIT_MAX_REQUESTS=100\nMAX_FILE_SIZE=10485760\n```\n\n## ğŸ—‚ï¸ Project Structure\n\n```\nPMFBY-Backend-database/\nâ”œâ”€â”€ .env                           # Environment variables\nâ”œâ”€â”€ .env.example                   # Environment template\nâ”œâ”€â”€ backend/                       # Node.js Backend\nâ”‚   â”œâ”€â”€ server.js                 # Main server file\nâ”‚   â”œâ”€â”€ package.json              # Dependencies\nâ”‚   â”œâ”€â”€ config/\nâ”‚   â”‚   â””â”€â”€ database.js           # MongoDB connection\nâ”‚   â”œâ”€â”€ models/                   # Database models\nâ”‚   â”‚   â”œâ”€â”€ User.js\nâ”‚   â”‚   â”œâ”€â”€ Crop.js\nâ”‚   â”‚   â”œâ”€â”€ Photo.js\nâ”‚   â”‚   â”œâ”€â”€ LoginSession.js\nâ”‚   â”‚   â””â”€â”€ Analytics.js\nâ”‚   â”œâ”€â”€ routes/                   # API routes\nâ”‚   â”‚   â”œâ”€â”€ auth.js              # Authentication\nâ”‚   â”‚   â”œâ”€â”€ user.js              # User management\nâ”‚   â”‚   â”œâ”€â”€ crop.js              # Crop management\nâ”‚   â”‚   â”œâ”€â”€ upload.js            # File upload\nâ”‚   â”‚   â”œâ”€â”€ ml.js                # ML integration\nâ”‚   â”‚   â””â”€â”€ analytics.js         # Analytics\nâ”‚   â”œâ”€â”€ middleware/\nâ”‚   â”‚   â””â”€â”€ auth.js              # Authentication middleware\nâ”‚   â”œâ”€â”€ utils/\nâ”‚   â”‚   â””â”€â”€ logger.js            # Logging utility\nâ”‚   â”œâ”€â”€ ml_server/               # Python ML Server\nâ”‚   â”‚   â”œâ”€â”€ app.py              # Flask ML server\nâ”‚   â”‚   â”œâ”€â”€ requirements.txt     # Python dependencies\nâ”‚   â”‚   â””â”€â”€ models/             # ML models directory\nâ”‚   â””â”€â”€ logs/                    # Log files\nâ”œâ”€â”€ lib/                         # Flutter App\nâ”‚   â”œâ”€â”€ models/                  # Data models\nâ”‚   â”‚   â”œâ”€â”€ user.dart\nâ”‚   â”‚   â””â”€â”€ crop.dart\nâ”‚   â””â”€â”€ services/                # API services\nâ”‚       â”œâ”€â”€ api_service.dart\nâ”‚       â””â”€â”€ http_client.dart\nâ””â”€â”€ pubspec.yaml                # Flutter dependencies\n```\n\n## ğŸ”‘ API Endpoints\n\n### Authentication\n- `POST /api/auth/register` - User registration\n- `POST /api/auth/login` - User login\n- `POST /api/auth/logout` - User logout\n- `POST /api/auth/refresh` - Token refresh\n- `GET /api/auth/me` - Get current user\n- `POST /api/auth/change-password` - Change password\n\n### User Management\n- `GET /api/users/profile` - Get user profile\n- `PUT /api/users/profile` - Update user profile\n- `GET /api/users/dashboard` - Get dashboard data\n- `GET /api/users/sessions` - Get user sessions\n- `DELETE /api/users/sessions/:sessionId` - Terminate session\n\n### Crop Management\n- `POST /api/crops` - Create new crop\n- `GET /api/crops` - Get user's crops\n- `GET /api/crops/:cropId` - Get crop details\n- `PUT /api/crops/:cropId` - Update crop\n- `POST /api/crops/:cropId/growth-stage` - Add growth stage\n- `POST /api/crops/:cropId/weather-event` - Add weather event\n- `GET /api/crops/statistics/summary` - Get crop statistics\n\n### Photo Upload\n- `POST /api/upload/photo` - Upload single photo\n- `POST /api/upload/photos` - Upload multiple photos\n- `GET /api/upload/photo/:photoId` - Get photo\n- `GET /api/upload/photos/user/:userId` - Get user photos\n\n### ML/AI Integration\n- `POST /api/ml/analyze/photo/:photoId` - Analyze photo\n- `POST /api/ml/predict/yield/:cropId` - Predict crop yield\n- `POST /api/ml/assess/risk/:cropId` - Assess crop risk\n- `GET /api/ml/health` - Check ML server status\n\n### Analytics\n- `GET /api/analytics/user/activity` - Get user activity\n- `POST /api/analytics/event` - Log analytics event\n\n## ğŸ“± Flutter Integration\n\n### API Service Usage\n```dart\n// Initialize HTTP client\nfinal httpClient = HttpClient.instance;\nfinal apiService = httpClient.apiService;\n\n// User login\ntry {\n  final loginRequest = LoginRequest(\n    emailOrPhone: \"user@example.com\",\n    password: \"password123\",\n    deviceInfo: DeviceInfo(\n      deviceType: \"Android\",\n      appVersion: \"1.0.0\",\n    ),\n  );\n  \n  final response = await apiService.login(loginRequest);\n  // Handle successful login\n} catch (e) {\n  // Handle error\n}\n\n// Upload photo\ntry {\n  final response = await apiService.uploadPhoto(\n    File('/path/to/photo.jpg'),\n    'crop_field',\n    'Crop field photo',\n    'rice,kharif',\n    cropId,\n    locationJson,\n  );\n  // Handle successful upload\n} catch (e) {\n  // Handle error\n}\n```\n\n## ğŸ” Database Schema\n\n### User Collection\n- Personal information (name, email, phone)\n- Address à¤”à¤° farming details\n- Authentication data\n- Settings à¤”à¤° preferences\n- Login tracking\n\n### Crop Collection\n- Crop basic information\n- Land details à¤”à¤° location\n- Crop calendar (sowing, harvest dates)\n- Insurance details\n- Monitoring data (fertilizer, pesticide, irrigation)\n- Growth stages tracking\n- Weather events à¤”à¤° damage assessment\n- Harvest data\n- AI analysis results\n\n### Photo Collection\n- File metadata à¤”à¤° storage info\n- GridFS reference\n- Photo type à¤”à¤° description\n- AI analysis results\n- Location data\n- Access control\n\n### LoginSession Collection\n- Session tracking\n- Device information\n- Security monitoring\n- Activity logging\n\n### Analytics Collection\n- User activity tracking\n- App usage statistics\n- Performance metrics\n- Error tracking\n\n## ğŸ›¡ï¸ Security Features\n\n- **JWT Authentication** with refresh tokens\n- **Password hashing** using bcrypt\n- **Rate limiting** per user à¤”à¤° IP\n- **Session management** with device validation\n- **Input validation** à¤”à¤° sanitization\n- **File upload security** with type checking\n- **CORS protection**\n- **Security headers**\n- **Suspicious activity detection**\n\n## ğŸ“Š ML/AI Features\n\n- **Disease Detection** - Crop disease identification\n- **Pest Detection** - Pest identification à¤”à¤° counting\n- **Crop Health Assessment** - Overall health scoring\n- **Yield Prediction** - ML-based yield forecasting\n- **Risk Assessment** - Comprehensive risk analysis\n- **Image Quality Assessment** - Photo quality validation\n\n## ğŸ”§ Configuration Options\n\n### Development vs Production\n```javascript\n// Development\nNODE_ENV=development\nLOG_LEVEL=debug\n\n// Production\nNODE_ENV=production\nLOG_LEVEL=info\n```\n\n### Database Configuration\n```javascript\n// MongoDB connection options\nconst options = {\n  useNewUrlParser: true,\n  useUnifiedTopology: true,\n  maxPoolSize: 10,\n  serverSelectionTimeoutMS: 5000,\n  socketTimeoutMS: 45000\n};\n```\n\n## ğŸ“ˆ Performance Optimization\n\n- **Database indexing** for better query performance\n- **Image compression** à¤”à¤° optimization\n- **Caching strategies** for frequent queries\n- **Connection pooling** for MongoDB\n- **Rate limiting** for API protection\n- **Logging optimization** with log rotation\n\n## ğŸ› Troubleshooting\n\n### Common Issues\n\n1. **MongoDB Connection Failed**\n   - Check internet connection\n   - Verify MongoDB URI\n   - Check firewall settings\n\n2. **ML Server Not Available**\n   - Ensure Python server is running\n   - Check ML_SERVER_URL in .env\n   - Verify Python dependencies\n\n3. **Flutter Build Errors**\n   - Run `flutter clean`\n   - Run `flutter pub get`\n   - Run build_runner: `flutter packages pub run build_runner build`\n\n4. **File Upload Issues**\n   - Check file size limits\n   - Verify file type restrictions\n   - Check GridFS configuration\n\n### Debug Commands\n```bash\n# Check backend server logs\ntail -f backend/logs/app.log\n\n# Check ML server logs\ntail -f backend/logs/ml_server.log\n\n# Test API endpoints\ncurl -X GET http://localhost:3000/health\n\n# Check MongoDB connection\nnode -e \"require('./backend/config/database')()\"\n```\n\n## ğŸš€ Deployment\n\n### Production Deployment\n1. Set production environment variables\n2. Install PM2 for process management\n3. Configure reverse proxy (Nginx)\n4. Set up SSL certificates\n5. Configure MongoDB Atlas production cluster\n6. Deploy ML models to production server\n\n### Docker Deployment (Optional)\n```dockerfile\n# Create Dockerfile for backend\nFROM node:18-alpine\nWORKDIR /app\nCOPY package*.json ./\nRUN npm install\nCOPY . .\nEXPOSE 3000\nCMD [\"npm\", \"start\"]\n```\n\n## ğŸ“ Support\n\nà¤…à¤—à¤° à¤†à¤ªà¤•à¥‹ à¤•à¥‹à¤ˆ issue à¤†à¤¤à¥€ à¤¹à¥ˆ à¤¤à¥‹:\n1. Logs check à¤•à¤°à¥‡à¤‚\n2. Environment variables verify à¤•à¤°à¥‡à¤‚\n3. Dependencies update à¤•à¤°à¥‡à¤‚\n4. Documentation refer à¤•à¤°à¥‡à¤‚\n\n---\n\n**Note**: à¤¯à¤¹ complete backend system à¤¹à¥ˆ à¤œà¥‹ production-ready à¤¹à¥ˆà¥¤ à¤¸à¤­à¥€ security measures à¤”à¤° best practices implement à¤•à¤¿à¤ à¤—à¤ à¤¹à¥ˆà¤‚à¥¤"